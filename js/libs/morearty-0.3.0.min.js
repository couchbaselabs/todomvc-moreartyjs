!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.Morearty=e()}}(function(){var e,t,n;return function r(e,t,n){function i(u,s){if(!t[u]){if(!e[u]){var o=typeof require=="function"&&require;if(!s&&o)return o(u,!0);if(a)return a(u,!0);var l=new Error("Cannot find module '"+u+"'");throw l.code="MODULE_NOT_FOUND",l}var f=t[u]={exports:{}};e[u][0].call(f.exports,function(t){var n=e[u][1][t];return i(n?n:t)},f,f.exports,r,e,t,n)}return t[u].exports}var a=typeof require=="function"&&require;for(var u=0;u<n.length;u++)i(n[u]);return i}({1:[function(e,t,n){t.exports=function(t){var n=e("./Util");var r=e("./util/Holder");var i,a,u;i=function(e,t,n){return new k(t,e._regCountHolder,n,e._listeners,e._listenerNestingLevelHolder)};a=function(e){return e._backingValueHolder.getValue()};u=function(e,t){e._backingValueHolder.setValue(t)};var s,o,l,f,c,v;s=[];o=".";l=function(e){return e?e.split(o).map(function(e){return isNaN(e)?e:+e}):[]};f=function(e){return typeof e==="string"?l(e):n.undefinedOrNull(e)?[]:e};c=function(e){return typeof e==="string"?e:e.join(o)};v=function(e,t){return e.concat(t)};var p,h,d,g,b,m;p=function(){throw new Error("Path must point to a key")};h=function(e,t){return t.length>0?e.getIn(t):e};d=function(e,t,n){var r=v(e._path,n);var i=t(a(e),r);u(e,i);return r};g=function(e,n,r){return d(e,function(e,r){var i=function(e,r){if(e){return e.has(r)?e.update(r,n):e.set(r,n())}else{return t.Map.empty().set(r,n())}};var a=r.length;switch(a){case 0:p();break;case 1:return i(e,r[0]);default:var u=r.slice(0,a-1);var s=r[a-1];return e.updateIn(u,function(e){return i(e,s)})}},r)};b=function(e,n){var r=v(e._path,n);var i=a(e);var s;var o=r.length;var l=r.slice(0,o-1);var f=function(e,n){if(e instanceof t.Vector){return e.splice(n,1).toVector()}else{return e.delete(n)}};switch(o){case 0:p();break;case 1:s=f(i,r[0]);break;default:var c=r[o-1];s=i.has(l[0])&&i.updateIn(l,function(e){return f(e,c)})||i}u(e,s);return l};m=function(e){return e?e.clear():e};var y,_,w,S,E,V,A;y=function(e,t){e._listenerNestingLevelHolder.updateValue(function(e){return e+1});t(e._listenerNestingLevelHolder.getValue());e._listenerNestingLevelHolder.updateValue(function(e){return e-1})};_=function(e,t){if(e.length===t.length){return""}else{return c(t.slice(e.length))}};w=function(e,t,r,i,a){var u=f(t);var s=f(r);var o=h(i,u);var l=h(a,u);if(o!==l){n.getPropertyValues(e).forEach(function(e){if(!e.disabled){e.cb(o,l,r,_(u,s))}})}};S=function(e,t,n,r,i){if(i<2){var a=e[""];if(a){w(a,s,c(t),n,r)}}};E=function(e,t){return n.startsWith(t,e)||n.startsWith(e,t)};V=function(e,t,r,i){var a=c(t);Object.keys(e).filter(n.identity).forEach(function(t){if(E(t,a)){w(e[t],t,a,r,i)}})};A=function(e,t,n){y(e,function(r){var i=a(e);V(e._listeners,t,i,n);S(e._listeners,t,i,n,r)})};var R,M;R=function(e,t){return n.find(n.getPropertyValues(e._listeners),function(e){return!!e[t]})};M=function(e,t,n){var r=R(e,t);if(r){r[t].disabled=n}};var k=function(e,t,n,i,a){this._backingValueHolder=e;this._regCountHolder=t||r.init(0);this._path=n||s;this._listeners=i||{};this._listenerNestingLevelHolder=a||r.init(0)};k.prototype=Object.freeze({init:function(e){return new k(r.init(e))},withBackingValue:function(e){return i(this,r.init(e),this._path)},setBackingValue:function(e,t){var n=a(this);this._backingValueHolder.setValue(e);if(t!==false){A(this,s,n)}},val:function(e){return h(a(this),v(this._path,f(e)))},sub:function(e){return i(this,this._backingValueHolder,v(this._path,f(e)))},update:function(e,t){var r=n.resolveArgs(arguments,"?subpath","update");var i=a(this);var u=g(this,r.update,f(r.subpath));A(this,u,i)},set:function(e,t){var r=n.resolveArgs(arguments,"?subpath","newValue");this.update(r.subpath,n.constantly(r.newValue))},"delete":function(e){var t=a(this);var n=b(this,f(e));A(this,n,t)},merge:function(e,r,i){var a=n.resolveArgs(arguments,function(e){return n.canRepresentSubpath(e)?"subpath":null},"?preserve","newValue");this.update(a.subpath,function(e){var r=a.newValue;if(n.undefinedOrNull(e)){return r}else{if(e instanceof t.Sequence&&r instanceof t.Sequence){return a.preserve?r.mergeDeep(e):e.mergeDeep(r)}else{return a.preserve?e:r}}})},clear:function(e){var t=f(e);if(a(this).getIn(t))this.update(t,function(e){return m(e)})},addListener:function(e,t){var n="reg"+this._regCountHolder.updateValue(function(e){return e+1});var r=c(v(this._path,f(e)));var i=this._listeners[r];var a={cb:t,disabled:false};if(i){i[n]=a}else{var u={};u[n]=a;this._listeners[r]=u}return n},addGlobalListener:function(e){return this.addListener(s,e)},enableListener:function(e){M(this,e,false)},disableListener:function(e){M(this,e,true)},withDisabledListener:function(e,t){var r=R(this,e);if(r){var i=r[e];i.disabled=true;n.afterComplete(t,function(){i.disabled=false})}else{t()}},removeListener:function(e){var t=R(this,e);return t?delete t[e]:false},atomically:function(){return new I(this,[],[])},asArrayPath:function(e){return f(e)},asStringPath:function(e){return c(e)},isInstance:function(e){return e instanceof k}});var I=function(e,t,n){this._binding=e;this._updates=t;this._removals=n;this._committed=false};I.prototype=function(){var e,r,i,u,s;e=function(e,t,n,r){var i=e._updates.slice(0);i.push({binding:t,update:n,subpath:r});return i};r=function(e,t,n){var r=e._removals.slice(0);r.push({binding:t,subpath:n});return r};i=function(e){return e._updates.length>0||e._removals.length>0};u=function(e){if(e.length<2){return e}else{var t=e.sort();var r=t[0],i=c(r);var a=[r];for(var u=1;u<t.length;u++){var s=t[u],o=c(s);if(!n.startsWith(o,i)){a.push(s);i=o}}return a}};s=function(e){if(!e._committed){var t=e._updates.map(function(e){return g(e.binding,e.update,e.subpath)});var n=e._removals.map(function(e){return b(e.binding,e.subpath)});e._committed=true;return t.concat(n)}else{throw new Error("Transaction already committed")}};return Object.freeze({update:function(t,r,i){var a=n.resolveArgs(arguments,function(e){return n.canRepresentSubpath(e)?"subpath":null},"?binding","update");var u=a.binding||this._binding;var s=e(this,u,a.update,f(a.subpath));return new I(u,s,this._removals)},set:function(e,t,r){var i=n.resolveArgs(arguments,function(e){return n.canRepresentSubpath(e)?"subpath":null},"?binding","newValue");return this.update(i.subpath,i.binding,n.constantly(i.newValue))},"delete":function(e,t){var i=n.resolveArgs(arguments,function(e){return n.canRepresentSubpath(e)?"subpath":null},"?binding");var a=i.binding||this._binding;var u=r(this,a,f(i.subpath));return new I(a,this._updates,u)},merge:function(e,r,i,a){var u=n.resolveArgs(arguments,function(e){return n.canRepresentSubpath(e)?"subpath":null},function(e){return typeof e==="boolean"?"preserve":null},"?binding","newValue");return this.update(u.subpath,u.binding,function(e){var r=u.newValue;if(n.undefinedOrNull(e)){return r}else{if(e instanceof t.Sequence&&r instanceof t.Sequence){return u.preserve?r.mergeDeep(e):e.mergeDeep(r)}else{return u.preserve?e:r}}})},clear:function(t,r){var i=n.resolveArgs(arguments,function(e){return n.canRepresentSubpath(e)?"subpath":null},"?binding");var a=i.binding||this._binding;var u=e(this,a,function(e){return m(e)},f(i.subpath));return new I(a,u,this._removals)},commit:function(e){if(i(this)){var t=this._binding;var n=a(t);var r=s(this);var o=a(t);if(e!==false){if(o!==n){var l=u(r);y(t,function(e){var r=t._listeners;l.forEach(function(e){V(r,e,o,n)});S(r,l[0],o,n,e)}.bind(t));return r}else{return[]}}else{return r}}else{return[]}}})}();return new k(r.init(null))}},{"./Util":5,"./util/Holder":7}],2:[function(e,t,n){t.exports=function(e){var t=e.DOM;var n=function(t,n){return e.createClass({getDisplayName:function(){return n},getInitialState:function(){return{value:this.props.value}},onChange:function(e){var t=this.props.onChange;if(t){var n=t(e);this.setState({value:e.target.value});return n}},componentWillReceiveProps:function(e){this.setState({value:e.value})},render:function(){return this.transferPropsTo(t({value:this.state.value,onChange:this.onChange,children:this.props.children}))}})};return{input:n(t.input,"input"),textarea:n(t.textarea,"textarea"),option:n(t.option,"option")}}},{}],3:[function(e,t,n){t.exports=function(e){var t,n,r,i,a,u;t=function(t){t.set(e.fromJS({listenerId:null,undo:[],redo:[]}))};n=function(t){t.atomically().set("undo",e.Vector.empty()).set("redo",e.Vector.empty()).commit()};r=function(e){var t=e.val("listenerId");e.removeListener(t);e.set(null)};i=function(t,n){var r=t.addListener([],function(r,i,a,u){n.atomically().update(function(n){return n.update("undo",function(n){var a=t.asArrayPath(u);return n.unshift(e.Map({newValue:a.length?r.getIn(a):r,oldValue:a.length?i.getIn(a):i,path:u}))}).set("redo",e.Vector.empty())}).commit(false)});n.atomically().set("listenerId",r).commit(false)};a=function(e,t,n,r){r.withDisabledListener(n,function(){r.set(e,t)})};u=function(e,t,n,r,i){var u=t.val();if(u.length>0){var s=u.get(0);t.atomically().delete(0).update(n,function(e){return e.unshift(s)}).commit(false);a(s.get("path"),s.get(i),r,e);return true}else{return false}};return{init:function(e,n){t(n);i(e,n)},clear:function(e){n(e)},destroy:function(e){r(e)},hasUndo:function(e){var t=e.val("undo");return!!t&&t.length>0},hasRedo:function(e){var t=e.val("redo");return!!t&&t.length>0},undo:function(e,t){var n=t.val("listenerId");var r=t.sub("undo");var i=t.sub("redo");return u(e,r,i,n,"oldValue")},redo:function(e,t){var n=t.val("listenerId");var r=t.sub("undo");var i=t.sub("redo");return u(e,i,r,n,"newValue")}}}},{}],4:[function(e,t,n){var r=e("./Util");var i=e("./Binding");var a=e("./History");var u=e("./util/Callback");var s=e("./DOM");var o=Object.freeze({OVERWRITE:"overwrite",OVERWRITE_EMPTY:"overwrite-empty",MERGE_PRESERVE:"merge-preserve",MERGE_REPLACE:"merge-replace"});var l,f,c;l=function(e,t,n){if(e){var r=t.props[e._configuration.bindingPropertyName];return n?r[n]:r}else{throw new Error("Context is missing.")}};f=function(e,t){var n=e.val();var r=t?e.withBackingValue(t).val():null;return n!==r};c=function(e,t){var n=e._previousState;if(e.Binding.isInstance(t)){return f(t,n)}else{var i=r.getPropertyValues(t);return!!r.find(i,function(e){return f(e,n)})}};var v=function(e,t,n){var i=this;var a=n.atomically();if(typeof e==="function"){a=a.update(function(n){return e(n,t)})}else{switch(e){case o.OVERWRITE:a=a.set(t);break;case o.OVERWRITE_EMPTY:a=a.update(function(e){var n=r.undefinedOrNull(e)||e instanceof i.Imm.Sequence&&e.count()===0;return n?t:e});break;case o.MERGE_PRESERVE:a=a.merge(true,t);break;case o.MERGE_REPLACE:a=a.merge(false,t);break;default:throw new Error("Invalid merge strategy: "+e)}}a.commit(false)};var p=function(e,t,n,r){this.React=e;this.Immutable=t;this.Imm=t;this.DOM=s(e);this.Binding=i(t);this.History=a(t);this._initialState=n;this._previousState=null;this._currentStateBinding=this.Binding.init(n);this._configuration=r;this._fullUpdateQueued=false;this._fullUpdateInProgress=false};p.prototype=Object.freeze({Util:r,Callback:u,getBinding:function(){return this._currentStateBinding},getCurrentState:function(){return this.getBinding().val()},getPreviousState:function(){return this._previousState},resetState:function(e,t){var n=r.resolveArgs(arguments,function(e){return typeof e==="boolean"?"notifyListeners":null},"?subpath");var i=n.notifyListeners!==false;if(n.subpath){var a=this.Binding.asArrayPath(n.subpath);this.getBinding().atomically().set(a,this._initialState.getIn(a)).commit(i)}else{this._currentStateBinding.setBackingValue(this._initialState,i)}},replaceState:function(e,t){this._currentStateBinding.setBackingValue(e,t)},isChanged:function(e,t,n){var i=r.resolveArgs(arguments,"binding",function(e){return r.canRepresentSubpath(e)?"subpath":null},"?compare");var a=i.binding.val(i.subpath);var u=i.binding.withBackingValue(this._previousState).val(i.subpath);return i.compare?!i.compare(a,u):a!==u},init:function(e){var t=this;var n=t._configuration.requestAnimationFrameEnabled;var r=window&&window.requestAnimationFrame;var i=function(n,r){t._previousState=r;if(t._fullUpdateQueued){t._fullUpdateInProgress=true;e.forceUpdate(function(){t._fullUpdateQueued=false;t._fullUpdateInProgress=false})}else{e.forceUpdate()}};t._currentStateBinding.addGlobalListener(function(e,a){if(n&&r){r(i.bind(t,e,a),null)}else{i(e,a)}})},queueFullUpdate:function(){this._fullUpdateQueued=true}});t.exports={Util:r,Callback:u,MergeStrategy:o,Mixin:{contextTypes:{morearty:function(){}},getMoreartyContext:function(){return this.context.morearty},getBinding:function(e){return l(this.getMoreartyContext(),this,e)},getDefaultBinding:function(){var e=this.getMoreartyContext();var t=l(e,this);if(e.Binding.isInstance(t)){return t}else if(typeof t==="object"){var n=Object.keys(t);return n.length===1?t[n[0]]:t["default"]}},getPreviousState:function(e){var t=this.getMoreartyContext();return l(t,this,e).withBackingValue(t._previousState).val()},componentWillMount:function(){var e=this.context.morearty;if(typeof this.getDefaultState==="function"){var t=this.getDefaultState();if(t){var n=l(e,this);var r=typeof this.getMergeStrategy==="function"?this.getMergeStrategy():o.MERGE_PRESERVE;var i=t instanceof e.Imm.Sequence;if(e.Binding.isInstance(n)){var a=i?t:t["default"];v.call(e,r,a,n)}else{var u=Object.keys(n);var s=u.length===1?u[0]:"default";var f=typeof r==="string"?r:r[s];if(i){v.call(e,f,t,n[s])}else{u.forEach(function(r){if(t[r]){v.call(e,f,t[r],n[r])}})}}}}},shouldComponentUpdate:function(e,t){var n=function(){var e=this.getMoreartyContext();if(e._fullUpdateInProgress){return true}else{var t=l(e,this);return!t||c(e,t)}}.bind(this);var r=this.shouldComponentUpdateOverride;return r?r(n,e,t):n()}},createContext:function(e,t,n,r){var i=t.Map;var a=n instanceof i?n:t.fromJS(n);var u=r||{};return new p(e,t,a,{bindingPropertyName:u.bindingPropertyName||"binding",requestAnimationFrameEnabled:u.requestAnimationFrameEnabled||false})}}},{"./Binding":1,"./DOM":2,"./History":3,"./Util":5,"./util/Callback":6}],5:[function(e,t,n){var r,i,a;r=function(e){return typeof e==="string"&&e.charAt(0)!=="?"};i=function(e,t){var n=t(e[0]);for(var r=1;r<e.length;r++){if(t(e[r])!==n)return r}return null};a=function(e,t){return e.slice(t).reverse().concat(e.slice(0,t))};t.exports={identity:function(e){return e},not:function(e){return!e},constantly:function(e){return function(){return e}},afterComplete:function(e,t){var n=e();if(n&&typeof n.always==="function"){n.always(t)}else{t()}},undefinedOrNull:function(e){return e===undefined||e===null},startsWith:function(e,t){return e.indexOf(t)===0},toString:function(e){switch(e){case undefined:return"undefined";case null:return"null";default:if(typeof e==="string"){return'"'+e+'"'}else if(Array.isArray(e)){return"["+e.join(", ")+"]"}else{return e.toString()}}},equals:function(e,t){return e===t||e&&e.equals&&e.equals(t)},getPropertyValues:function(e){return Object.keys(e).map(function(t){return e[t]})},find:function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(t(r,n,e)){return r}}return null},resolveArgs:function(e,t){var n={};if(arguments.length>1){var u=Array.isArray(t)?t:Array.prototype.slice.call(arguments,1);var s,o;var l;if(r(u[0])||!(l=i(u,r))){s=u;o=e}else{var f=Array.isArray(e)?e:Array.prototype.slice.call(e);s=a(u,l);o=a(f,f.length-(u.length-l))}for(var c=0,v=0;c<s.length&&v<o.length;c++){var p=s[c],h=o[v];if(r(p)){n[p]=h;v++}else{var d=typeof p==="function"?p(h):p.charAt(0)!=="?"?p:p.substring(1);if(d||h===undefined){n[d]=h;v++}}}}return n},canRepresentSubpath:function(e){var t=typeof e;return t==="string"||t==="number"||Array.isArray(e)},shallowMerge:function(e,t){for(var n in e){if(e.hasOwnProperty(n)){t[n]=e[n]}}return t},papply:function(e,t,n){var r=this;var i=function(t,n){var a=arguments.length>1?Array.prototype.slice.call(arguments,1):null;if(t){var u={};if(i._props){r.shallowMerge(i._props,u);r.shallowMerge(t,u)}else{u=t}return e(u,a)}else{return e(i._props,a)}};if(e._props){var a={};if(n!==false){r.shallowMerge(e._props,a);r.shallowMerge(t,a)}else{r.shallowMerge(t,a);r.shallowMerge(e._props,a)}i._props=a}else{i._props=t}return i}}},{}],6:[function(e,t,n){var r=e("../Util");t.exports={set:function(e,t,n){var i=r.resolveArgs(arguments,"binding",function(e){return r.canRepresentSubpath(e)?"subpath":null},"?f");return function(t){var n=t.target.value;e.set(i.subpath,i.f?i.f(n):n);return false}},"delete":function(e,t,n){var i=r.resolveArgs(arguments,"binding",function(e){return r.canRepresentSubpath(e)?"subpath":null},"?pred");return function(t){var n=t.target.value;if(!i.pred||i.pred(n)){e.delete(i.subpath)}return false}},onKey:function(e,t,n,i){var a=n||false;var u=i||false;return function(n){var i=typeof t==="string"?n.key===t:r.find(t,function(e){return e===n.key});if(i&&n.shiftKey===a&&n.ctrlKey===u){e(n);return false}else{return true}}},onEnter:function(e){return this.onKey(e,"Enter")},onEscape:function(e){return this.onKey(e,"Escape")}}},{"../Util":5}],7:[function(e,t,n){var r=function(e){this._value=e};r.prototype=Object.freeze({init:function(e){return new r(e)},getValue:function(){return this._value},setValue:function(e){this._value=e},updateValue:function(e){var t=this._value;this._value=e(t);return t}});t.exports=new r(null)},{}]},{},[4])(4)});