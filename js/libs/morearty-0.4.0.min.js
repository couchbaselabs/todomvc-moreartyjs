!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.Morearty=e()}}(function(){var e,t,n;return function r(e,t,n){function i(u,o){if(!t[u]){if(!e[u]){var s=typeof require=="function"&&require;if(!o&&s)return s(u,!0);if(a)return a(u,!0);var l=new Error("Cannot find module '"+u+"'");throw l.code="MODULE_NOT_FOUND",l}var f=t[u]={exports:{}};e[u][0].call(f.exports,function(t){var n=e[u][1][t];return i(n?n:t)},f,f.exports,r,e,t,n)}return t[u].exports}var a=typeof require=="function"&&require;for(var u=0;u<n.length;u++)i(n[u]);return i}({1:[function(e,t,n){(function(n){var r=e("./Util");var i=e("./util/Holder");var a=typeof window!=="undefined"?window.Immutable:typeof n!=="undefined"?n.Immutable:null;var u,o,s;u=function(e,t,n){return new x(t,e._regCountHolder,n,e._listeners,e._listenerNestingLevelHolder,e._cache)};o=function(e){return e._backingValueHolder.getValue()};s=function(e,t){e._backingValueHolder.setValue(t)};var l,f,c,d,p,v;l=[];f=".";c=function(e){return e?e.split(f).map(function(e){return isNaN(e)?e:+e}):[]};d=function(e){switch(typeof e){case"string":return c(e);case"number":return[e];default:return r.undefinedOrNull(e)?[]:e}};p=function(e){switch(typeof e){case"string":return e;case"number":return e.toString();default:return r.undefinedOrNull(e)?"":e.join(f)}};v=function(e,t){return e.concat(t)};var h,g,b,y,m,_;h=function(){throw new Error("Path must point to a key")};g=function(e,t){return t.length>0?e.getIn(t):e};b=function(e,t,n){var r=v(e._path,n);var i=t(o(e),r);s(e,i);return r};y=function(e,t,n){return b(e,function(e,n){var r=function(e,n){if(e){return e.has(n)?e.update(n,t):e.set(n,t())}else{return a.Map.empty().set(n,t())}};var i=n.length;switch(i){case 0:return t(e);case 1:return r(e,n[0]);default:var u=n.slice(0,i-1);var o=n[i-1];return e.updateIn(u,function(e){return r(e,o)})}},n)};m=function(e,t){var n=v(e._path,t);var r=o(e);var i;var u=n.length;var l=n.slice(0,u-1);var f=function(e,t){if(e instanceof a.Vector){return e.splice(t,1).toVector()}else{return e&&e.delete(t)}};switch(u){case 0:h();break;case 1:i=f(r,n[0]);break;default:var c=n[u-1];i=r.has(l[0])&&r.updateIn(l,function(e){return f(e,c)})||r}s(e,i);return l};_=function(e){return e instanceof a.Sequence?e.clear():null};var w,S,E,V,R,A,M;w=function(e,t){e._listenerNestingLevelHolder.updateValue(function(e){return e+1});t(e._listenerNestingLevelHolder.getValue());e._listenerNestingLevelHolder.updateValue(function(e){return e-1})};S=function(e,t){if(e.length===t.length){return""}else{return p(t.slice(e.length))}};E=function(e,t,n,i,a){var u=d(t);var o=d(n);var s=g(i,u);var l=g(a,u);if(s!==l){r.getPropertyValues(e).forEach(function(e){if(!e.disabled){e.cb(s,l,n,S(u,o))}})}};V=function(e,t,n,r,i){if(i<2){var a=e[""];if(a){E(a,l,p(t),n,r)}}};R=function(e,t){return r.startsWith(t,e)||r.startsWith(e,t)};A=function(e,t,n,i){var a=p(t);Object.keys(e).filter(r.identity).forEach(function(t){if(R(t,a)){E(e[t],t,a,n,i)}})};M=function(e,t,n){w(e,function(r){var i=o(e);A(e._listeners,t,i,n);V(e._listeners,t,i,n,r)})};var O,k;O=function(e,t){return r.find(r.getPropertyValues(e._listeners),function(e){return!!e[t]})};k=function(e,t,n){var r=O(e,t);if(r){r[t].disabled=n}};var x=function(e,t,n,r,a,u){this._backingValueHolder=e;this._regCountHolder=t||i.init(0);this._path=n||l;this._listeners=r||{};this._listenerNestingLevelHolder=a||i.init(0);this._cache=u||{}};x.init=function(e){return new x(i.init(e||a.Map.empty()))};x.asArrayPath=function(e){return d(e)};x.asStringPath=function(e){return p(e)};x.prototype=Object.freeze({withBackingValue:function(e){return u(this,i.init(e),this._path)},setBackingValue:function(e,t){var n=o(this);this._backingValueHolder.setValue(e);if(t!==false){M(this,l,n)}},val:function(e){return g(o(this),v(this._path,d(e)))},sub:function(e){var t=v(this._path,d(e));if(t.length>0){var n=p(t);var r=this._cache[n];if(r){return r}else{var i=u(this,this._backingValueHolder,t);this._cache[n]=i;return i}}else{return this}},update:function(e,t){var n=r.resolveArgs(arguments,"?subpath","update");var i=o(this);var a=y(this,n.update,d(n.subpath));M(this,a,i);return this},set:function(e,t){var n=r.resolveArgs(arguments,"?subpath","newValue");return this.update(n.subpath,r.constantly(n.newValue))},"delete":function(e){var t=o(this);var n=m(this,d(e));M(this,n,t);return this},merge:function(e,t,n){var i=r.resolveArgs(arguments,function(e){return r.canRepresentSubpath(e)?"subpath":null},"?preserve","newValue");return this.update(i.subpath,function(e){var t=i.newValue;if(r.undefinedOrNull(e)){return t}else{if(e instanceof a.Sequence&&t instanceof a.Sequence){return i.preserve?t.mergeDeep(e):e.mergeDeep(t)}else{return i.preserve?e:t}}})},clear:function(e){var t=d(e);if(this.val(t))this.update(t,_);return this},addListener:function(e,t){var n=r.resolveArgs(arguments,function(e){return r.canRepresentSubpath(e)?"subpath":null},"cb");var i="reg"+this._regCountHolder.updateValue(function(e){return e+1});var a=p(v(this._path,d(n.subpath||"")));var u=this._listeners[a];var o={cb:n.cb,disabled:false};if(u){u[i]=o}else{var s={};s[i]=o;this._listeners[a]=s}return i},addGlobalListener:function(e){return this.addListener(l,e)},enableListener:function(e){k(this,e,false);return this},disableListener:function(e){k(this,e,true);return this},withDisabledListener:function(e,t){var n=O(this,e);if(n){var i=n[e];i.disabled=true;r.afterComplete(t,function(){i.disabled=false})}else{t()}return this},removeListener:function(e){var t=O(this,e);return t?delete t[e]:false},atomically:function(){return new C(this,[],[])}});var C=function(e,t,n){this._binding=e;this._updates=t;this._removals=n;this._committed=false};C.prototype=function(){var e,t,n,i,u,s;e=function(e,t,n,r){var i=e._updates.slice(0);i.push({binding:t,update:n,subpath:r});return i};t=function(e,t,n){var r=e._removals.slice(0);r.push({binding:t,subpath:n});return r};n=function(e){return e._updates.length>0||e._removals.length>0};i=function(e,t){var n=e.length,r=t.length;return n===r&&(n===1||e[n-2]===t[n-2])};u=function(e){if(e.length<2){return e}else{var t=e.sort();var n=t[0],a=p(n);var u=[n];for(var o=1;o<t.length;o++){var s=t[o],l=p(s);if(!r.startsWith(l,a)){if(i(s,n)){var f=s.slice(0,s.length-1);u.pop();u.push(f);n=f;a=p(f)}else{u.push(s);n=s;a=l}}}return u}};s=function(e){if(!e._committed){var t=e._updates.map(function(e){return y(e.binding,e.update,e.subpath)});var n=e._removals.map(function(e){return m(e.binding,e.subpath)});e._committed=true;return t.concat(n)}else{throw new Error("Transaction already committed")}};return Object.freeze({update:function(t,n,i){var a=r.resolveArgs(arguments,function(e){return r.canRepresentSubpath(e)?"subpath":null},"?binding","update");var u=a.binding||this._binding;var o=e(this,u,a.update,d(a.subpath));return new C(u,o,this._removals)},set:function(e,t,n){var i=r.resolveArgs(arguments,function(e){return r.canRepresentSubpath(e)?"subpath":null},"?binding","newValue");return this.update(i.subpath,i.binding,r.constantly(i.newValue))},"delete":function(e,n){var i=r.resolveArgs(arguments,function(e){return r.canRepresentSubpath(e)?"subpath":null},"?binding");var a=i.binding||this._binding;var u=t(this,a,d(i.subpath));return new C(a,this._updates,u)},merge:function(e,t,n,i){var u=r.resolveArgs(arguments,function(e){return r.canRepresentSubpath(e)?"subpath":null},function(e){return typeof e==="boolean"?"preserve":null},"?binding","newValue");return this.update(u.subpath,u.binding,function(e){var t=u.newValue;if(r.undefinedOrNull(e)){return t}else{if(e instanceof a.Sequence&&t instanceof a.Sequence){return u.preserve?t.mergeDeep(e):e.mergeDeep(t)}else{return u.preserve?e:t}}})},clear:function(t,n){var i=r.resolveArgs(arguments,function(e){return r.canRepresentSubpath(e)?"subpath":null},"?binding");var a=i.binding||this._binding;var u=e(this,a,function(e){return _(e)},d(i.subpath));return new C(a,u,this._removals)},commit:function(e){if(n(this)){var t=this._binding;var r=o(t);var i=s(this);var a=o(t);if(e!==false){if(a!==r){var l=u(i);w(t,function(e){var n=t._listeners;l.forEach(function(e){A(n,e,a,r)});V(n,l[0],a,r,e)}.bind(t));return i}else{return[]}}else{return i}}else{return[]}}})}();t.exports=x}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./Util":5,"./util/Holder":7}],2:[function(e,t,n){(function(e){var n=typeof window!=="undefined"?window.React:typeof e!=="undefined"?e.React:null;var r=n.DOM;var i=function(e,t){return n.createClass({getDisplayName:function(){return t},getInitialState:function(){return{value:this.props.value}},onChange:function(e){var t=this.props.onChange;if(t){var n=t(e);this.setState({value:e.target.value});return n}},componentWillReceiveProps:function(e){this.setState({value:e.value})},render:function(){return this.transferPropsTo(e({value:this.state.value,onChange:this.onChange,children:this.props.children}))}})};var a={input:i(r.input,"input"),textarea:i(r.textarea,"textarea"),option:i(r.option,"option")};t.exports=a}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],3:[function(e,t,n){(function(n){var r=typeof window!=="undefined"?window.Immutable:typeof n!=="undefined"?n.Immutable:null;var i=e("./Binding");var a,u,o,s,l,f;a=function(e){e.set(r.fromJS({listenerId:null,undo:[],redo:[]}))};u=function(e){e.atomically().set("undo",r.Vector.empty()).set("redo",r.Vector.empty()).commit()};o=function(e,t){var n=e.val("listenerId");e.removeListener(n);e.atomically().set(null).commit(t)};s=function(e,t){var n=e.addListener([],function(e,n,a,u){t.atomically().update(function(t){return t.update("undo",function(t){var a=i.asArrayPath(u);return t&&t.unshift(r.Map({newValue:a.length?e.getIn(a):e,oldValue:a.length?n.getIn(a):n,path:u}))}).set("redo",r.Vector.empty())}).commit(false)});t.atomically().set("listenerId",n).commit(false)};l=function(e,t,n,r){r.withDisabledListener(n,function(){r.set(e,t)})};f=function(e,t,n,r,i){var a=t.val();if(a.length>0){var u=a.get(0);t.atomically().delete(0).update(n,function(e){return e.unshift(u)}).commit(false);l(u.get("path"),u.get(i),r,e);return true}else{return false}};var c={init:function(e,t){a(t);s(e,t)},clear:function(e){u(e)},destroy:function(e,t){o(e,t)},hasUndo:function(e){var t=e.val("undo");return!!t&&t.length>0},hasRedo:function(e){var t=e.val("redo");return!!t&&t.length>0},undo:function(e,t){var n=t.val("listenerId");var r=t.sub("undo");var i=t.sub("redo");return f(e,r,i,n,"oldValue")},redo:function(e,t){var n=t.val("listenerId");var r=t.sub("undo");var i=t.sub("redo");return f(e,i,r,n,"newValue")}};t.exports=c}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./Binding":1}],4:[function(e,t,n){(function(n){var r=e("./Util");var i=e("./Binding");var a=e("./History");var u=e("./util/Callback");var o=e("./DOM");var s=typeof window!=="undefined"?window.Immutable:typeof n!=="undefined"?n.Immutable:null;var l=s;var f=Object.freeze({OVERWRITE:"overwrite",OVERWRITE_EMPTY:"overwrite-empty",MERGE_PRESERVE:"merge-preserve",MERGE_REPLACE:"merge-replace"});var c,d,p;c=function(e,t,n){if(e){var r=t.props[e._configuration.bindingPropertyName];return n?r[n]:r}else{throw new Error("Context is missing.")}};d=function(e,t){var n=e.val();var r=t?e.withBackingValue(t).val():null;return n!==r};p=function(e,t){var n=e._previousState;if(t instanceof i){return d(t,n)}else{var a=r.getPropertyValues(t);return!!r.find(a,function(e){return e&&d(e,n)})}};var v=function(e,t,n){var i=n.atomically();if(typeof e==="function"){i=i.update(function(n){return e(n,t)})}else{switch(e){case f.OVERWRITE:i=i.set(t);break;case f.OVERWRITE_EMPTY:i=i.update(function(e){var n=r.undefinedOrNull(e)||e instanceof l.Sequence&&e.count()===0;return n?t:e});break;case f.MERGE_PRESERVE:i=i.merge(true,t);break;case f.MERGE_REPLACE:i=i.merge(false,t);break;default:throw new Error("Invalid merge strategy: "+e)}}i.commit(false)};var h=function(e,t){this._initialState=e;this._previousState=null;this._currentState=e;this._currentStateBinding=i.init(e);this._configuration=t;this._fullUpdateQueued=false;this._fullUpdateInProgress=false};h.prototype=Object.freeze({getBinding:function(){return this._currentStateBinding},getCurrentState:function(){return this.getBinding().val()},getPreviousState:function(){return this._previousState},resetState:function(e,t){var n=r.resolveArgs(arguments,function(e){return typeof e==="boolean"?"notifyListeners":null},"?subpath");var a=n.notifyListeners!==false;if(n.subpath){var u=i.asArrayPath(n.subpath);this.getBinding().atomically().set(u,this._initialState.getIn(u)).commit(a)}else{this._currentStateBinding.setBackingValue(this._initialState,a)}},replaceState:function(e,t){this._currentStateBinding.setBackingValue(e,t)},isChanged:function(e,t,n){var i=r.resolveArgs(arguments,"binding",function(e){return r.canRepresentSubpath(e)?"subpath":null},"?compare");var a=i.binding.withBackingValue(this._currentState).val(i.subpath);var u=i.binding.withBackingValue(this._previousState).val(i.subpath);return i.compare?!i.compare(a,u):a!==u},init:function(e){var t=this;var n=t._configuration.requestAnimationFrameEnabled;var r=window&&window.requestAnimationFrame;var i=function(n,r){if(e.isMounted()){t._currentState=n;t._previousState=r;try{if(t._fullUpdateQueued){t._fullUpdateInProgress=true;e.forceUpdate(function(){t._fullUpdateQueued=false;t._fullUpdateInProgress=false})}else{e.forceUpdate()}}catch(i){if(t._configuration.stopOnRenderError){throw i}else{console.error("Morearty: skipping render error",i)}}}};t._currentStateBinding.addGlobalListener(function(e,a){if(n&&r){r(i.bind(t,e,a),null)}else{i(e,a)}})},queueFullUpdate:function(){this._fullUpdateQueued=true}});t.exports={Binding:i,History:a,Util:r,Callback:u,DOM:o,MergeStrategy:f,Mixin:{contextTypes:{morearty:function(){}},getMoreartyContext:function(){return this.context.morearty},getBinding:function(e){return c(this.getMoreartyContext(),this,e)},getDefaultBinding:function(){var e=this.getMoreartyContext();var t=c(e,this);if(t instanceof i){return t}else if(typeof t==="object"){var n=Object.keys(t);return n.length===1?t[n[0]]:t["default"]}},getPreviousState:function(e){var t=this.getMoreartyContext();return c(t,this,e).withBackingValue(t._previousState).val()},componentWillMount:function(){if(typeof this.getDefaultState==="function"){var e=this.getMoreartyContext();var t=this.getDefaultState();if(t){var n=c(e,this);var r=typeof this.getMergeStrategy==="function"?this.getMergeStrategy():f.MERGE_PRESERVE;var a=t instanceof l.Sequence;if(n instanceof i){var u=a?t:t["default"];v.call(e,r,u,n)}else{var o=Object.keys(n);var s=o.length===1?o[0]:"default";var d=typeof r==="string"?r:r[s];if(a){v.call(e,d,t,n[s])}else{o.forEach(function(r){if(t[r]){v.call(e,d,t[r],n[r])}})}}}}},shouldComponentUpdate:function(e,t){var n=function(){var e=this.getMoreartyContext();if(e._fullUpdateInProgress){return true}else{var t=c(e,this);return!t||p(e,t)}}.bind(this);var r=this.shouldComponentUpdateOverride;return r?r(n,e,t):n()}},createContext:function(e,t){var n=s.Sequence;var r=e instanceof n?e:s.fromJS(e);var i=t||{};return new h(r,{bindingPropertyName:i.bindingPropertyName||"binding",requestAnimationFrameEnabled:i.requestAnimationFrameEnabled||false,stopOnRenderError:i.stopOnRenderError||false})}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./Binding":1,"./DOM":2,"./History":3,"./Util":5,"./util/Callback":6}],5:[function(e,t,n){var r,i,a;r=function(e){return typeof e==="string"&&e.charAt(0)!=="?"};i=function(e,t){var n=t(e[0]);for(var r=1;r<e.length;r++){if(t(e[r])!==n)return r}return null};a=function(e,t){return e.slice(t).reverse().concat(e.slice(0,t))};t.exports={identity:function(e){return e},not:function(e){return!e},constantly:function(e){return function(){return e}},async:function(e){setTimeout(e,0)},afterComplete:function(e,t){var n=e();if(n&&typeof n.always==="function"){n.always(t)}else{t()}},undefinedOrNull:function(e){return e===undefined||e===null},startsWith:function(e,t){return e.indexOf(t)===0},toString:function(e){switch(e){case undefined:return"undefined";case null:return"null";default:if(typeof e==="string"){return'"'+e+'"'}else if(Array.isArray(e)){return"["+e.join(", ")+"]"}else{return e.toString()}}},equals:function(e,t){return e===t||e&&e.equals&&e.equals(t)},getPropertyValues:function(e){return Object.keys(e).map(function(t){return e[t]})},find:function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(t(r,n,e)){return r}}return null},resolveArgs:function(e,t){var n={};if(arguments.length>1){var u=Array.isArray(t)?t:Array.prototype.slice.call(arguments,1);var o,s;var l;if(r(u[0])||!(l=i(u,r))){o=u;s=e}else{var f=Array.isArray(e)?e:Array.prototype.slice.call(e);o=a(u,l);s=a(f,f.length-(u.length-l))}for(var c=0,d=0;c<o.length&&d<s.length;c++){var p=o[c],v=s[d];if(r(p)){n[p]=v;d++}else{var h=typeof p==="function"?p(v):p.charAt(0)!=="?"?p:p.substring(1);if(h||v===undefined){n[h]=v;d++}}}}return n},canRepresentSubpath:function(e){var t=typeof e;return t==="string"||t==="number"||Array.isArray(e)},shallowMerge:function(e,t){for(var n in e){if(e.hasOwnProperty(n)){t[n]=e[n]}}return t},papply:function(e,t,n){var r=this;var i=function(t,n){var a=arguments.length>1?Array.prototype.slice.call(arguments,1):null;if(t){var u={};if(i._props){r.shallowMerge(i._props,u);r.shallowMerge(t,u)}else{u=t}return e(u,a)}else{return e(i._props,a)}};if(e._props){var a={};if(n!==false){r.shallowMerge(e._props,a);r.shallowMerge(t,a)}else{r.shallowMerge(t,a);r.shallowMerge(e._props,a)}i._props=a}else{i._props=t}return i}}},{}],6:[function(e,t,n){var r=e("../Util");t.exports={set:function(e,t,n){var i=r.resolveArgs(arguments,"binding",function(e){return r.canRepresentSubpath(e)?"subpath":null},"?f");return function(t){var n=t.target.value;e.set(i.subpath,i.f?i.f(n):n);return false}},"delete":function(e,t,n){var i=r.resolveArgs(arguments,"binding",function(e){return r.canRepresentSubpath(e)?"subpath":null},"?pred");return function(t){var n=t.target.value;if(!i.pred||i.pred(n)){e.delete(i.subpath)}return false}},onKey:function(e,t,n,i){var a=n||false;var u=i||false;return function(n){var i=typeof t==="string"?n.key===t:r.find(t,function(e){return e===n.key});if(i&&n.shiftKey===a&&n.ctrlKey===u){e(n);return false}else{return true}}},onEnter:function(e){return this.onKey(e,"Enter")},onEscape:function(e){return this.onKey(e,"Escape")}}},{"../Util":5}],7:[function(e,t,n){var r=function(e){this._value=e};r.prototype=Object.freeze({init:function(e){return new r(e)},getValue:function(){return this._value},setValue:function(e){this._value=e},updateValue:function(e){var t=this._value;this._value=e(t);return t}});t.exports=new r(null)},{}]},{},[4])(4)});